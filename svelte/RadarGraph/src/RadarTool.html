<div width="100%">
    <div id="RadarInputs">
        <h1>Radar Worksheet</h1>
        <b>Range</b><input id="range" type="number" bind:value="range" max="100" width="10px" /><br />
        <b>Increment</b><input id="incr" type="number" bind:value="incr" max="100" width="10px" /><br />
    </div>
    <div id="RadarChart">
        <svg id="RadarSVG" width="500" height="500" viewbox="-250 -250 250 250">
            <!-- create circles for the scale -->
            {{#each marks as mark}}
            <circle class="marker" cx="{{centerx}}" cy="{{centery}}" r="{{magnify(mark)}}" stroke-width="0.5" />
            {{/each}}
            <defs>
                <g id="spoke" class="spoke" style="background:transparent">
                    <path fill="transparent" stroke="#111" stroke-width="1" d="M{{centerx}},{{centery}} l{{magnify(range)}},0" />
                    <!-- <use xlink:href="#icon-photo" width="20" height="20"/>-->
                </g>
            </defs>

            <!-- create spokes foreach facet to be measured-->
            {{#each facets as facet, f}}
                <g transform="rotate({{angle(f)}},{{centerx}},{{centery}})">
                    <text class="facet-label" x={{centerx+magnify(range)}} y={{centery-range}} text-anchor="middle" transform="rotate(90,{{centerx+magnify(range)}},{{centery-range}})">{{facet}}</text>
                    <use xlink:href="#spoke" />
                </g>
            {{/each}}

            {{#each data as d}}
                <polygon points="{{facet_points(d)}}" style="fill:transparent;stroke:purple;stroke-width:2" />
            {{/each}}
        </svg>
    </div>
</div>
<style>
    #RadarChart {
        position:absolute;
        left:500px;
        width:100%;
        height:100%;
    }
    #RadarInputs {
        position:absolute;
        left:0%;
        width:50%;
    }
    circle.marker {
        stroke:gray;
        fill:none;
    }
</style>
<script>
    export default {
        data(){
            return {
                range:10,
                incr:1,
                scale:20,
                facets:[],
                data:[],
                centerx:250,
                centery:250
            }
        },
        computed:{
            base_angle:facets=>{
                if(!facets||!facets.length||facets.length==0){
                    console.warn("Can't compute section angle without at least 1 facet",{facets:facets});
                    return 360;
                }
                else return 360/facets.length;
            },
            marks:(range,incr)=> { //marks = number of concentric circles shown
                var xs = [];
                var x=0;
                while(x<=range){
                    xs.push(x);
                    x+=incr;
                }
                return xs;
            },
            magnify:(scale)=>{ //TODO - include scale as a 'toolbox' control on UI
                return (factor)=>{ return factor * scale; }
            },
            angle:(base_angle)=>{
                return (index)=>{ return index*base_angle; }
            },
            facet_points:(facets)=>{
                return (data_rec)=>{return "200,10 250,190 160,210"}
            },

        }
    }
</script>
